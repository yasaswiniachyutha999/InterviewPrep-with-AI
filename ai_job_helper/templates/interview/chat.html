{% extends "base.html" %}
{% block content %}
<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white border-b border-gray-200 sticky top-0 z-10">
        <div class="max-w-4xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
                        <span class="text-white font-semibold">AI</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold text-gray-800">Mock Interview</h1>
                        <p class="text-sm text-gray-500">AI-powered interview practice</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span class="text-sm text-gray-500">Active</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="max-w-4xl mx-auto px-4 py-6">
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 min-h-[600px] flex flex-col">
            <!-- Chat Messages -->
            <div id="chat-messages" class="flex-1 p-6 space-y-6 overflow-y-auto">
                {% for m in messages %}
                    {% if m.role == 'interviewer' %}
                        <!-- Interviewer Message (Left Side) -->
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white text-sm font-semibold">AI</span>
                            </div>
                            <div class="flex-1">
                                <div class="bg-gray-50 rounded-2xl rounded-tl-sm p-4 max-w-3xl">
                                    <div class="prose prose-sm max-w-none">
                                        {{ m.content|linebreaks }}
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 mt-2 ml-4">
                                    <span class="text-xs text-gray-500">{{ m.timestamp|date:"M. j, Y, g:i a"|default:"Just now" }}</span>
                                </div>
                            </div>
                        </div>
                    {% elif m.role == 'candidate' %}
                        <!-- Candidate Message (Right Side) -->
                        <div class="flex items-start space-x-3 justify-end">
                            <div class="flex-1 max-w-3xl">
                                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-2xl rounded-tr-sm p-4 ml-auto">
                                    <div class="prose prose-sm max-w-none prose-invert">
                                        {{ m.content|linebreaks }}
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2 mt-2 mr-4 justify-end">
                                    <span class="text-xs text-gray-500">{{ m.timestamp|date:"M. j, Y, g:i a"|default:"Just now" }}</span>
                                </div>
                            </div>
                            <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-gray-600 text-sm font-semibold">You</span>
                            </div>
                        </div>
                    {% endif %}
                {% empty %}
                    <!-- Welcome Message -->
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center flex-shrink-0">
                            <span class="text-white text-sm font-semibold">AI</span>
                        </div>
                        <div class="flex-1">
                            <div class="bg-gray-50 rounded-2xl rounded-tl-sm p-4 max-w-3xl">
                                <div class="prose prose-sm max-w-none">
                                    <p class="text-gray-800">Hello! I'm your AI interview coach. I'll be asking you questions based on the job description you provided. Take your time to think through each answer, and I'll provide feedback to help you improve.</p>
                                    <p class="text-gray-600 mt-2">Let's begin with the first question...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>

            <!-- Input Area -->
            {% if not session.completed %}
                <div class="border-t border-gray-200 p-6">
                    <form method="post" id="chat-form" class="space-y-4">
                        {% csrf_token %}
                        <div class="relative">
                            <textarea 
                                name="answer" 
                                id="answer-input"
                                rows="3" 
                                required
                                class="w-full px-4 py-3 pr-12 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all duration-200"
                                placeholder="Type your answer here..."
                            ></textarea>
                            <button 
                                type="submit"
                                class="absolute right-2 bottom-2 w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg flex items-center justify-center hover:from-blue-600 hover:to-purple-700 transition-all duration-200"
                            >
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-500">
                                Press <kbd class="px-2 py-1 bg-gray-100 rounded text-xs">Enter</kbd> to send, <kbd class="px-2 py-1 bg-gray-100 rounded text-xs">Shift + Enter</kbd> for new line
                            </p>
                            <button 
                                type="submit"
                                class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-2 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-all duration-200"
                            >
                                Send Answer
                            </button>
                        </div>
                    </form>
                </div>
            {% else %}
                <!-- Interview Completed -->
                <div class="border-t border-gray-200 p-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Interview Completed!</h3>
                        <p class="text-gray-600 mb-6">Great job! You've completed the mock interview session.</p>
                        <div class="flex space-x-4 justify-center">
                            <a href="{% url 'interview_home' %}" 
                               class="bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-6 rounded-lg transition-colors">
                                Start New Interview
                            </a>
                            <a href="{% url 'home' %}" 
                               class="bg-gradient-to-r from-blue-500 to-purple-600 text-white font-semibold py-2 px-6 rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200">
                                Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<script>
// Auto-scroll to bottom of chat
function scrollToBottom() {
    const chatMessages = document.getElementById('chat-messages');
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Auto-resize textarea
const textarea = document.getElementById('answer-input');
if (textarea) {
    textarea.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 120) + 'px';
    });
}

// Handle Enter key
if (textarea) {
    textarea.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            document.getElementById('chat-form').submit();
        }
    });
}

// Scroll to bottom on page load
window.addEventListener('load', scrollToBottom);

// Auto-scroll when new messages are added
const observer = new MutationObserver(scrollToBottom);
const chatMessages = document.getElementById('chat-messages');
if (chatMessages) {
    observer.observe(chatMessages, { childList: true });
}
</script>
{% endblock %}
